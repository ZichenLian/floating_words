<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>宝宝 我想你了</title>
<style>
  html,body,#stage{height:100%;margin:0}
  #stage{
    position:relative;overflow:hidden;background:#111;
    padding:env(safe-area-inset-top) env(safe-area-inset-right)
            env(safe-area-inset-bottom) env(safe-area-inset-left);
    touch-action:manipulation;
  }
  .card{
    position:absolute;border-radius:18px;background:#ffd1dc;color:#5a2a2a;
    display:flex;align-items:center;justify-content:center;text-align:center;
    box-shadow:0 6px 18px rgba(0,0,0,.25);padding:8px;word-break:break-word;
    will-change:transform;white-space:nowrap;
    transform:translate3d(-50%,-50%,0); /* 以中心定位 */
    animation-name:floatY;animation-timing-function:ease-in-out;
    animation-iteration-count:infinite;animation-direction:alternate;
  }
  @keyframes floatY{
    from{ transform:translate3d(-50%,-50%,0) }
    to  { transform:translate3d(-50%,calc(-50% + var(--amp, -10px)),0) }
  }
</style>
</head>
<body>
<div id="stage"></div>
<script>
/* ===== 可调参数（重点看这几个） ===== */
const MESSAGES = [
  "宝宝 我想你了","你别不理我","我真的很想你","为什么这么久不理我","我想你了","好爱你呀"
];
const PINKS = ["#ffeaf0","#ffdce7","#ffccde","#ffbfd6","#ffaecb","#ff9fbe","#ff90b3","#ff81a8","#ff729d","#ff648f"];
let   INTERVAL = 180;   // 出现速度（毫秒）
const JITTER   = 6;     // 每点微抖动，越小越规整
const GAP_FACTOR = 0.8; // 轮廓相邻卡片的最小间距系数（基于卡片宽度，0.8~1.2之间调）
/* 漂浮 */
const AMP_MIN=6, AMP_MAX=12, DUR_MIN=3.0, DUR_MAX=5.0;
/* =============================== */

const stage = document.getElementById('stage');
const sw = ()=>stage.clientWidth, sh = ()=>stage.clientHeight;

/* 自适应卡片尺寸 */
function cardMetrics(){
  const m = Math.min(sw(), sh());
  const w = Math.max(90, Math.min(140, Math.round(m*0.28)));
  const h = Math.max(36, Math.round(w*0.30));
  const f = Math.max(12, Math.round(w*0.15));
  return {w,h,f};
}

/* 心形参数方程 */
function heartXY(t){
  const x = 16*Math.pow(Math.sin(t),3);
  const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
  return [x,y];
}

/* 生成“外轮廓等弧长点”：保证相邻点像素距离 >= minDist */
function heartOutline(minDist){
  // 先采样足够密的点，再按像素弧长抽样
  const dense = [];
  const N = 1200;  // 越大轮廓越平滑
  for(let i=0;i<N;i++){
    const t = i/N * Math.PI*2;
    dense.push(heartXY(t));
  }
  // 标准化到屏幕
  let minX=Infinity,maxX=-Infinity,minY=Infinity,maxY=-Infinity;
  for(const [x,y] of dense){ if(x<minX)minX=x; if(x>maxX)maxX=x; if(y<minY)minY=y; if(y>maxY)maxY=y; }
  const spanX = maxX-minX, spanY = maxY-minY;
  const short = Math.min(sw(), sh());
  const scale = (short*0.78) / Math.max(spanX, spanY); // 78% 的短边
  const cx = sw()/2, cy = sh()/2 + 8;

  const pts = dense.map(([x,y])=>[
    cx + (x - (minX+spanX/2))*scale,
    cy + (-(y - (minY+spanY/2))*scale)
  ]);

  // 按像素弧长采样
  const out = [];
  let last = null, acc = 0;
  for(let i=0;i<pts.length;i++){
    const p = pts[i], q = pts[(i+1)%pts.length];
    if(!last){ out.push(p); last = p; continue; }
    const dx = p[0]-last[0], dy = p[1]-last[1];
    const d  = Math.hypot(dx,dy);
    acc += d;
    if(acc >= minDist){
      out.push(p); last = p; acc = 0;
    }
  }
  return out;
}

/* 生成卡片 */
function addCard(pos, metrics){
  const [x0,y0] = pos;
  const x = x0 + (Math.random()*2-1)*JITTER;
  const y = y0 + (Math.random()*2-1)*JITTER;

  const el = document.createElement('div');
  el.className = 'card';
  el.style.left = x+'px';
  el.style.top  = y+'px';
  el.style.width  = metrics.w+'px';
  el.style.height = metrics.h+'px';
  el.style.font   = `700 ${metrics.f}px/1.2 "PingFang SC","Microsoft YaHei",system-ui,sans-serif`;
  el.style.background = PINKS[Math.floor(Math.random()*PINKS.length)];
  el.textContent = MESSAGES[Math.floor(Math.random()*MESSAGES.length)];

  // 随机轻微旋转（更自然）
  const rot = (Math.random()*6 - 3).toFixed(1); // -3° ~ 3°
  el.style.transform += ` rotate(${rot}deg)`;

  // 飘动
  const amp = (Math.random()*(AMP_MAX-AMP_MIN)+AMP_MIN).toFixed(1);
  const dur = (Math.random()*(DUR_MAX-DUR_MIN)+DUR_MIN).toFixed(2);
  el.style.setProperty('--amp', `-${amp}px`);
  el.style.animationDuration = `${dur}s`;
  el.style.animationDelay = `-${(Math.random()*dur).toFixed(2)}s`;

  stage.appendChild(el);
}

/* 主流程：只沿轮廓等距放置，几乎不重叠 */
function run(){
  stage.innerHTML = '';
  const metrics = cardMetrics();
  const minDist = metrics.w * GAP_FACTOR; // 控制轮廓间距的关键
  const outline = heartOutline(minDist);

  let i = 0;
  const tick = ()=>{
    if(i >= outline.length) return;
    addCard(outline[i], metrics);
    i++;
    if(i < outline.length) setTimeout(tick, INTERVAL);
  };
  tick();
}

/* 初始化与自适应 */
run();
let to=null;
window.addEventListener('resize',()=>{ clearTimeout(to); to=setTimeout(run,200); });
</script>
</body>
</html>
